Для запуска решения требуется:
- функция data_execute()
- функция data_preproc()
- функция model_predict()
- модель meanCT_model.h5

Тома - архивы, где каждый отдельный том = один пациент.
Срезы - КТ-изображения.

# Пред-обработка срезов КТ перед подачей в модель 

### **!Требования к скармливаемым модели данным!**
Модель ожидает тензор размерности (B=None/1, W=512, H=512, C=1), где:
* B - количество батчей (достаточно, чтобы был равен 1 или None);
* W - ширина изображения в пикселях (требуется 512 пикселей);
* H - высота изображения в пиккселях (требуется 512 пикселей);
* C - количество каналов (требуется 1 канал).

Дополнительно необходимо, чтобы:
- из массива срезов выбирался средний (медианный) срез;
- пиксели выбранного среза в тензоре должны быть нормализованы по максимальному значению массива;
- пиксели должны храниться в формате float32.

Пример обработчика массива изображений КТ (взято из функции data_preproc):
*imgs_np = imgs_np.astype(np.float32) # перевод пикселей в float32*
*imgs_np /= np.max(np.abs(imgs_np)) # нормализация по максимальному пикселю в изображении*
*(обычно это самый светлый пиксель)*
*mid_index = len(data) // 2 # находим центральный индекс массива и по нему обращаемся к элементу*
*mean_slice = imgs_np[mid_index, :, :][..., np.newaxis] # добавляем к среднему срезу из массива*
*imgs_np ровно 1 канал*
*img = img.squeeze() # добавляем к этому одному изображению 1 батч*

Без приведения изображе(ия/ий) к данным требованиям модель не заработает.

### Извлечение данных c data_execute()
Для приведения принимаемых данных (архив с томами, папка с срезами и тд) используется 
data_execute. Функция принимает в себя путь к хранилищу данных __path__. 
- Обрабатываемые форматы хранилища информации: .zip, .tar, .rar.
- Обрабатываемые форматы томов/срезов: .dcm, .nii, .gz.

Необходимо определить конфиг для модели, где будет хранится путь __TMP_PATH__ (на данный момент TMP_PATH определен внутри функции), 
в котором будет хранится временно извлеченная из архивов информация.

Функция возвращает сырой массив срезов в пиксельном формате (если были переданы чисто срезы, не сжатые в тома) или
массив с томами в которых хранятся пиксельные массивы срезов. Она дополнительно возвращает тип медицинской информации:
'slices' или 'volumes'. 
          
### Приведение данных к релевантному виду с data_preproc()
data_preproc() ожидает массив срезов/томов через аргумент __data__, а так же форму хранения в виде __storing_type__ равному или "slices" или "volumes". 
Именно в этой функции происходит нормализация, приведение к float, добавление канала и все описанные в требованиях операции. 
На выходе функции получаем один средний срез (если __storing_type__ == "slices") или массив средних срезов (если __storing_type__ == "volumes").

# Подача изображения на предикт модели c model_predict()
Прежде всего мы загружаем модель:
*model = load_model('/content/meanCT_model.h5')*

И далее передаем ей один файл среза:
*predictions = model.predict(x=file0)*

Получаем два float значения, равные соответственно вероятности нормы или патологии:
*array([[0.3959544 , 0.60404557]], dtype=float32)*

Это было реализовано в функции model_predict(), которая принимает соответственно тензор изображения __img__ и путь к модели __model_pth__.

# Ссылки
### data_execute(): https://github.com/Epeiste-mort/HACK-18.09.25/blob/main/scripts/data_execute.py
### data_preproc(): https://github.com/Epeiste-mort/HACK-18.09.25/blob/main/scripts/data_preproc.py
### model_predict(): https://github.com/Epeiste-mort/HACK-18.09.25/blob/main/scripts/model_predict.py
## requierements.txt: https://github.com/Epeiste-mort/HACK-18.09.25/blob/main/requirements.txt
